<!-- src/app/app.component.html -->

<div style="font-family: Arial, sans-serif;">
  <!-- Header -->
  <header style="background: #2c3e50; color: white; padding: 20px;">
    <h1>üõ°Ô∏è OWASP ASVS Checklist Helper</h1>
    <div style="margin-top: 10px;">
      <button (click)="exportJSON()" style="padding: 10px 20px; margin-right: 10px; cursor: pointer;">
        üì• Export JSON
      </button>
      <button (click)="reset()" style="padding: 10px 20px; cursor: pointer;">
        üîÑ Reset
      </button>
    </div>
  </header>

  @if (checklist) {
    <!-- Summary Dashboard -->
    <div style="padding: 20px; background: #ecf0f1;">
      <h2>üìä Overall Progress</h2>
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
          <h3 style="margin: 0; color: #3498db;">{{ checklist.getTotalCompleted() }}</h3>
          <p style="margin: 5px 0 0 0; color: #7f8c8d;">Completed</p>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
          <h3 style="margin: 0; color: #27ae60;">{{ checklist.getTotalValid() }}</h3>
          <p style="margin: 5px 0 0 0; color: #7f8c8d;">Valid</p>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
          <h3 style="margin: 0; color: #e74c3c;">{{ checklist.getTotalInvalid() }}</h3>
          <p style="margin: 5px 0 0 0; color: #7f8c8d;">Invalid</p>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
          <h3 style="margin: 0; color: #9b59b6;">Level {{ checklist.getOverallLevel() }}</h3>
          <p style="margin: 5px 0 0 0; color: #7f8c8d;">ASVS Level</p>
        </div>
      </div>

      <!-- Summary Table -->
      <table border="1" cellpadding="10" style="width: 100%; border-collapse: collapse; background: white;">
        <thead style="background: #34495e; color: white;">
          <tr>
            <th>Security Category</th>
            <th>Valid</th>
            <th>Total</th>
            <th>Percentage</th>
            <th>ASVS Level</th>
          </tr>
        </thead>
        <tbody>
          @for (sum of checklist.summary; track sum.securityCategory) {
            <tr [style.background]="sum.securityCategory === 'Total' ? '#f8f9fa' : 'white'"
                [style.font-weight]="sum.securityCategory === 'Total' ? 'bold' : 'normal'">
              <td>{{ sum.securityCategory }}</td>
              <td style="text-align: center;">{{ sum.validCriteria }}</td>
              <td style="text-align: center;">{{ sum.totalCriteria }}</td>
              <td style="text-align: center;">{{ sum.validityPercentage }}%</td>
              <td style="text-align: center;">
                @if (sum.asvsLevelAcquired > 0) {
                  <span style="color: #27ae60;">Level {{ sum.asvsLevelAcquired }}</span>
                } @else {
                  <span style="color: #95a5a6;">-</span>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Categories List -->
    <div style="padding: 20px;">
      <h2>üìã Security Categories</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
        @for (category of checklist.categories; track category.name) {
          <div (click)="selectCategory(category)" 
               [style.background]="selectedCategory?.name === category.name ? '#3498db' : 'white'"
               [style.color]="selectedCategory?.name === category.name ? 'white' : 'black'"
               style="padding: 20px; border-radius: 8px; cursor: pointer; border: 2px solid #ecf0f1;">
            <h3 style="margin: 0 0 10px 0;">{{ category.name }}</h3>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
              <span>Valid: {{ category.validCriteria }}/{{ category.totalCriteria }}</span>
              <span>{{ category.validityPercentage }}%</span>
            </div>
            <div style="background: rgba(0,0,0,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
              <div [style.width.%]="category.validityPercentage" 
                   style="background: #27ae60; height: 100%;"></div>
            </div>
            @if (category.asvsLevelAcquired > 0) {
              <p style="margin: 10px 0 0 0; font-size: 14px;">
                üèÜ Level {{ category.asvsLevelAcquired }} Acquired
              </p>
            }
          </div>
        }
      </div>
    </div>

    <!-- Requirements List -->
    @if (selectedCategory) {
      <div style="padding: 20px; background: #ecf0f1;">
        <h2>üìù {{ selectedCategory.name }} - Requirements</h2>
        <table border="1" cellpadding="10" style="width: 100%; border-collapse: collapse; background: white;">
          <thead style="background: #34495e; color: white;">
            <tr>
              <th style="width: 80px;">#</th>
              <th>Requirement</th>
              <th style="width: 80px;">Level</th>
              <th style="width: 120px;">Status</th>
              <th style="width: 100px;">Action</th>
            </tr>
          </thead>
          <tbody>
            @for (req of selectedCategory.requirements; track req.id) {
              <tr>
                <td style="text-align: center;">{{ req.id }}</td>
                <td>{{ req.verificationRequirement.substring(0, 150) }}...</td>
                <td style="text-align: center;">L{{ req.asvsLevel }}</td>
                <td style="text-align: center;">
                  @if (req.valid === 'Valid') {
                    <span style="color: #27ae60; font-weight: bold;">‚úÖ Valid</span>
                  } @else if (req.valid === 'Invalid') {
                    <span style="color: #e74c3c; font-weight: bold;">‚ùå Invalid</span>
                  } @else if (req.valid === 'Not Applicable') {
                    <span style="color: #95a5a6;">‚ö™ N/A</span>
                  } @else {
                    <span style="color: #f39c12;">‚è≥ Pending</span>
                  }
                </td>
                <td style="text-align: center;">
                  <button (click)="selectRequirement(req)" 
                          style="padding: 5px 15px; cursor: pointer;">
                    Check
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    <!-- Requirement Detail Modal -->
    @if (selectedRequirement) {
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">{{ selectedRequirement.id }}</h2>
            <button (click)="selectedRequirement = null" 
                    style="padding: 5px 15px; cursor: pointer;">
              ‚úï Close
            </button>
          </div>

          <p style="background: #ecf0f1; padding: 15px; border-radius: 5px; line-height: 1.6;">
            {{ selectedRequirement.verificationRequirement }}
          </p>

          <div style="margin: 20px 0;">
            <strong>ASVS Level:</strong> {{ selectedRequirement.asvsLevel }} |
            @if (selectedRequirement.cwe) {
              <strong>CWE:</strong> {{ selectedRequirement.cwe }} |
            }
            @if (selectedRequirement.nist) {
              <strong>NIST:</strong> {{ selectedRequirement.nist }}
            }
          </div>

          <h3>Select Implementation Status:</h3>
          <div style="margin: 20px 0;">
            @for (option of selectedRequirement.options; track option.id) {
              <label style="display: block; padding: 15px; margin: 10px 0; border: 2px solid #ecf0f1; border-radius: 5px; cursor: pointer;"
                     [style.background]="option.isSelected ? '#3498db' : 'white'"
                     [style.color]="option.isSelected ? 'white' : 'black'">
                <input type="radio" 
                       [name]="'option-' + selectedRequirement.id"
                       [checked]="option.isSelected"
                       (change)="selectOption(option.id)"
                       style="margin-right: 10px;">
                {{ option.name }}
              </label>
            }
          </div>

          <div style="margin-top: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">
              Comments / Notes:
            </label>
            <textarea [(ngModel)]="selectedRequirement.comment"
                      (change)="dataService.updateRequirement(selectedCategory!.name, selectedRequirement!.id, { comment: selectedRequirement!.comment })"
                      style="width: 100%; padding: 10px; min-height: 100px; border: 1px solid #ddd; border-radius: 5px;"
                      placeholder="Add your comments here..."></textarea>
          </div>

          <div style="margin-top: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">
              Source Code Reference:
            </label>
            <input type="text" 
                   [(ngModel)]="selectedRequirement.sourceCodeReference"
                   (change)="dataService.updateRequirement(selectedCategory!.name, selectedRequirement!.id, { sourceCodeReference: selectedRequirement!.sourceCodeReference })"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"
                   placeholder="e.g., UserController.cs:125">
          </div>

          <div style="margin-top: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">
              Tool Used:
            </label>
            <input type="text" 
                   [(ngModel)]="selectedRequirement.toolUsed"
                   (change)="dataService.updateRequirement(selectedCategory!.name, selectedRequirement!.id, { toolUsed: selectedRequirement!.toolUsed })"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"
                   placeholder="e.g., SonarQube, OWASP ZAP">
          </div>
        </div>
      </div>
    }
  } @else {
    <div style="padding: 50px; text-align: center;">
      <h2>Loading...</h2>
    </div>
  }
</div>